(this.webpackJsonpclient_src=this.webpackJsonpclient_src||[]).push([[20],{377:function(e,s,t){"use strict";t.r(s);var a=t(112),r=t(12),o=t(2),i=t(3),n=t(28),l=t(5),c=t(4),d=t(0),u=t(23),p=t(9),h=t(47),m=t(111),g=t(113),b=t(114),f=t(497),j=t(26),x=t(654),w=t.n(x),O=t(372),v=t(10),S=t(20),T=t(469),U=(t(442),t(461)),C=t.n(U),H=t(1),R=function(e){return[{Header:e("usuarios.usuarios"),foldable:!0,columns:[{Header:"ID",accessor:"id",show:!1},{Header:e("usuarios.nombre"),accessor:"nombre"},{accessor:"apellido",Header:e("usuarios.apellido")},{accessor:"username",Header:e("usuarios.username")},{accessor:"email",Header:e("usuarios.email")},{accessor:"password",Header:e("usuarios.password"),show:!1},{Header:"",filterable:!1,sortable:!1,width:40,Cell:function(s){return Object(H.jsx)("button",{className:w.a.eliminar,alt:e("general.eliminar"),children:Object(H.jsx)(S.Icon,{name:"close"})})}}]}]},D=function(e){return[{Header:e("usuarios.roles"),foldable:!0,columns:[{Header:"ID",accessor:"id",show:!1},{Header:e("roles.name"),accessor:"name"},{Header:e("roles.description"),accessor:"description"},{Header:"",filterable:!1,sortable:!1,width:40,Cell:function(s){return Object(H.jsx)("button",{className:w.a.eliminar,alt:e("general.eliminar"),children:Object(H.jsx)(S.Icon,{name:"close"})})}}]}]},N=function(e){Object(l.a)(t,e);var s=Object(c.a)(t);function t(e){var i;return Object(o.a)(this,t),(i=s.call(this,e)).getData=function(){var e=Object(n.a)(i);Object(b.e)().then((function(s){e.setState({usuarios:s.data})})).catch((function(s){console.error(s.response),401===s.response.status&&e.setState({ifYouCan:!1})}))},i.getRoles=function(){var e=Object(n.a)(i);Object(f.e)().then((function(s){var t=[];i.state.roles.length>0?i.state.roles.forEach((function(e,a){s.data.forEach((function(s,a){e.name===s.name&&t.push(a)}))})):t=s.data,t.forEach((function(e,t){s.data.splice(e-t,1)})),e.setState({allroles:s.data})})).catch((function(s){console.error(s.response),401===s.response.status&&e.setState({ifYouCan:!1})}))},i.componentDidMount=function(){i.getData()},i.handleInputChange=function(e){var s=Object(r.a)(Object(r.a)({},i.state.user),{},Object(a.a)({},e.target.name,e.target.value));i.setState({user:s})},i.addGeneralRol=function(e){var s=Object(n.a)(i);Object(f.d)("General").then((function(s){i.handlerAddRole(e,s.data[0].name)})).catch((function(e){i.setState({wait:!1}),console.error(e.response),s.setState({msgUsuario:void 0!==e.response?i.props.t("role."+e.response.data.error.message):i.props.t("role.error")})}))},i.handlerSubmit=function(e){i.setState({wait:!0});var s=Object(n.a)(i);e.preventDefault(),"crear"===i.state.modeUsuario&&""===i.state.user.id?Object(b.b)({nombre:i.state.user.nombre,apellido:i.state.user.apellido,username:i.state.user.username,email:i.state.user.email,password:i.state.user.password}).then((function(e){200===e.status?(i.getData(),i.props.t("usuarios.create"),i.setState({user:{id:"",nombre:"",apellido:"",username:"",email:""},modeUsuario:"crear",wait:!1,Usuario:i.props.t("general.creadoOK")})):(i.setState({wait:!1}),console.error(e),s.setState({msgUsuario:void 0!==e.data?i.props.t("usuarios."+e.data.response.message):i.props.t("usuarios.error")}))})).catch((function(e){i.setState({wait:!1}),console.error(e.response),s.setState({msgUsuario:void 0!==e.response?i.props.t("usuarios."+e.response.data.error.message):i.props.t("usuarios.error")})})):Object(b.c)({nombre:i.state.user.nombre,apellido:i.state.user.apellido,username:i.state.user.username,email:i.state.user.email,id:i.state.user.id,password:i.state.user.password}).then((function(e){i.getData(),i.setState({userid:"",nombre:"",apellido:"",username:"",email:"",mode:i.props.t("general.crear"),wait:!1,msgUsuario:i.props.t("general.modificadoOK")})})).catch((function(e){i.setState({wait:!1}),console.error(e.response),s.setState({msgUsuario:void 0!==e.response?i.props.t("usuarios."+e.response.data.error.code):i.props.t("usuarios.error")})}))},i.handlerClear=function(){i.setState({user:{id:"",nombre:"",apellido:"",username:"",email:""},roles:[],sesiones:[],modeUsuario:"crear",wait:!1,msgUsuario:""})},i.handlerGridAction=function(e,s,t,a){return{onClick:function(e){void 0!==s&&(i.setState({user:{id:s.original.id,nombre:s.original.nombre,apellido:s.original.apellido,username:s.original.username,email:s.original.email,password:s.original.password},roles:s.original.roles,msgUsuario:"",modeUsuario:"editar"}),Object(b.h)(s.original.id).then((function(e){s.original.accessTokens.length!==e.data.accessTokens.length?i.setState({sesiones:e.data.accessTokens}):i.setState({sesiones:s.original.accessTokens})})),i.getRoles(),""===t.Header&&(!0===window.confirm(i.props.t("general.estaseguro"))?i.handlerDelete(s.original.id):i.handlerClear()))}}},i.handlerGridActionSessiones=function(e,s,t,a){return{onClick:function(e){void 0!==s&&(""===t.Header&&(!0===window.confirm(i.props.t("general.estaseguro"))?i.handlerDeleteSession(s.original.id):i.handlerClear()))}}},i.handlerGridActionRoles=function(e,s,t,a){return{onClick:function(e){void 0!==s&&(""===t.Header&&(!0===window.confirm(i.props.t("general.estaseguro"))?i.handlerDeleteRol(i.state.user.id,s.original.name):i.handlerClear()))}}},i.handlerDelete=function(e){var s=Object(n.a)(i);Object(b.d)(e).then((function(e){i.handlerClear(),i.getData().then((function(){})),i.setState({msgUsuario:i.props.t("usuarios.eliminadoOK")})})).catch((function(e){console.error(e.response),s.setState({msgUsuario:void 0!==e.response?i.props.t("usuarios."+e.response.data.error.code):i.props.t("usuarios.error")})}))},i.handlerDeleteSession=function(e){var s=Object(n.a)(i);Object(j.c)(e).then((function(e){1===e.data.count?Object(b.h)(i.state.user.id).then((function(e){i.setState({sesiones:e.data.accessTokens,msgUsuario:i.props.t("session.eliminadoOK")})})):i.setState({msgUsuario:i.props.t("session.eliminadoError")})})).catch((function(e){console.error(e.response),s.setState({msgUsuario:void 0!==e.response?i.props.t("session."+e.response.data.error.code):i.props.t("session.error")})}))},i.handlerDeleteRol=function(e,s){var t=Object(n.a)(i);Object(b.i)(e,s).then((function(){Object(b.g)(i.state.user.id).then((function(e){i.getRoles(),i.setState({roles:e.data.roles,msgUsuario:i.props.t("usuarios.roleDeleted")})}))})).catch((function(e){console.error(e.response),t.setState({msgUsuario:void 0!==e.response?i.props.t("usuarios."+e.response.data.error.code):i.props.t("usuarios.error")})}))},i.handlerAddRole=function(e,s){void 0===s&&(e=i.state.user.id,s=i.state.allroles.filter((function(e){return e.name===i.state.rolSelected}))[0]);var t=Object(n.a)(i);Object(b.a)(e,s).then((function(e){Object(b.g)(i.state.user.id).then((function(e){i.getRoles(),i.setState({roles:e.data.roles,msgUsuario:i.props.t("usuarios.rollAdded")})}))})).catch((function(e){console.error(e.response),t.setState({msgUsuario:void 0!==e.response?i.props.t("usuarios."+e.response.data.error.code):i.props.t("usuarios.error")})}))},i.handlerSelectChange=function(e){i.setState({rolSelected:e.target.value})},i.handlerGoAddRoles=function(e){i.setState((function(e){return{ifYouAddRole:!e.ifYouAddRole,msgUsuario:""}}))},i._columns=R,i.state={user:{id:"",username:"",nombre:"",email:"",apellido:"",password:""},ifYouCan:!0,ifYouAddRole:!1,usuarios:[],roles:[],sesiones:[],allroles:[],rolSelected:"",msgUsuario:"",modeUsuario:"crear",wait:!1},i}return Object(i.a)(t,[{key:"render",value:function(){return this.state.ifYouCan?this.state.ifYouAddRole?Object(H.jsxs)(u.a,{direction:"columns",padding:"1rem",margin:"0",wrap:"wrap",children:[Object(H.jsx)(p.a,{height:"100%",padding:"0",width:"25%",animate:!0,children:Object(H.jsxs)(u.a,{direction:"column",padding:"0",margin:"0",wrap:"nowrap",round:"3px",children:[Object(H.jsx)("div",{className:w.a.title,children:Object(H.jsx)("h3",{children:this.props.t("usuarios.addrole")})}),Object(H.jsx)("div",{className:w.a.icon,children:Object(H.jsxs)("span",{className:"fa-stack fa-lg",children:[Object(H.jsx)("i",{className:"fa fa-circle fa-stack-2x fa-inverse "+w.a.shadow}),Object(H.jsx)("i",{className:"fa fa-shield fa-stack-1x "})]})}),Object(H.jsxs)("div",{className:"padding-default",children:[Object(H.jsx)(g.a,{id:"RolesToUser",items:this.state.allroles,itemId:"name",itemText:"name",onSelect:this.handlerSelectChange}),Object(H.jsx)(m.a,{visible:"editar"===this.state.modeUsuario,type:"outline",loading:this.state.wait,disabled:this.state.wait,text:this.props.t("general.volver"),id:"volverToUsers",icon:"arrow-left",width:"100%",classes:w.a.btn,onPress:this.handlerGoAddRoles}),Object(H.jsx)(m.a,{visible:!0,loading:this.state.wait,disabled:""===this.state.rolSelected,text:this.props.t("usuarios.addrole"),styleType:"success",id:"addRoleToUser",icon:"shield",width:"100%",classes:w.a.btn,onPress:this.handlerAddRole})]}),Object(H.jsx)("div",{className:"center",children:this.state.msgUsuario})]})}),Object(H.jsx)(p.a,{height:"100%",padding:"0",width:"74%",auto:!0,children:Object(H.jsx)(T.a,{className:"-striped -highlight",data:this.state.roles,columns:D(this.props.t),sortable:!0,multiSort:!0,resizable:!0,filterable:!0,defaultPageSize:25,getTdProps:this.handlerGridActionRoles,previousText:this.props.t("general.previous"),nextText:this.props.t("general.next"),loadingText:this.props.t("general.loading"),noDataText:this.props.t("general.norowsfound"),pageText:this.props.t("general.page"),ofText:this.props.t("general.of"),rowsText:this.props.t("general.rows")})})]}):Object(H.jsxs)(u.a,{direction:"columns",padding:"1rem",margin:"0",wrap:"wrap",children:[Object(H.jsx)(p.a,{height:"100%",padding:"0",width:"25%",animate:!0,children:Object(H.jsxs)(u.a,{direction:"column",padding:"0",margin:"0",wrap:"nowrap",round:"3px",children:[Object(H.jsx)("div",{className:w.a.title,children:Object(H.jsx)("h3",{children:"crear"===this.state.modeUsuario?this.props.t("usuarios.newUsuario"):this.props.t("usuarios.modificarUsuario",{usuario:this.state.user.username})})}),Object(H.jsx)("div",{className:w.a.icon,children:Object(H.jsxs)("span",{className:"fa-stack fa-lg",children:[Object(H.jsx)("i",{className:"fa fa-circle fa-stack-2x fa-inverse "+w.a.shadow}),Object(H.jsx)("i",{className:"fa fa-user fa-stack-1x "})]})}),Object(H.jsxs)("div",{className:"padding-default",children:[Object(H.jsx)(h.a,{id:"nombre",type:"text",label:this.props.t("usuarios.nombre"),placeholder:this.props.t("usuarios.nombre"),value:this.state.user.nombre||"",onChange:this.handleInputChange}),Object(H.jsx)(h.a,{id:"apellido",type:"text",label:this.props.t("usuarios.apellido"),placeholder:this.props.t("usuarios.apellido"),value:this.state.user.apellido||"",onChange:this.handleInputChange}),Object(H.jsx)(h.a,{id:"username",type:"text",label:this.props.t("usuarios.username"),placeholder:this.props.t("usuarios.username"),value:this.state.user.username||"",onChange:this.handleInputChange}),Object(H.jsx)(h.a,{id:"email",type:"text",required:!0,autocomplete:!1,label:this.props.t("usuarios.email"),placeholder:this.props.t("usuarios.email"),value:this.state.user.email||"",onChange:this.handleInputChange}),Object(H.jsx)(h.a,{id:"password",type:"password",label:this.props.t("usuarios.password"),placeholder:this.props.t("usuarios.password"),autocomplete:!1,required:!0,value:this.state.user.password||"",onChange:this.handleInputChange}),Object(H.jsxs)("div",{className:"center",children:[Object(H.jsx)(m.a,{visible:!0,loading:this.state.wait,disabled:""===this.state.user.username||""===this.state.user.nombre||""===this.state.user.email||""===this.state.user.apellido,text:"crear"===this.state.modeUsuario?this.props.t("general.crear"):this.props.t("general.editar"),styleType:"success",id:"guardar",icon:"user",width:"100%",classes:w.a.btn,onPress:this.handlerSubmit}),Object(H.jsx)(m.a,{visible:"editar"===this.state.modeUsuario,loading:this.state.wait,disabled:this.state.wait,text:this.props.t("usuarios.addrole"),styleType:"info",id:"goToAddRole",icon:"shield",width:"100%",classes:w.a.btn,onPress:this.handlerGoAddRoles}),Object(H.jsx)(m.a,{visible:"editar"===this.state.modeUsuario,type:"outline",loading:this.state.wait,disabled:this.state.wait,text:this.props.t("general.cancelar"),id:"cancelar",icon:"eraser",width:"100%",classes:w.a.btn,onPress:this.handlerClear})]})]}),Object(H.jsx)("div",{className:"center",children:this.state.msgUsuario})]})}),Object(H.jsxs)(p.a,{height:"100%",padding:"0",width:"74%",animate:!0,children:[Object(H.jsx)(T.a,{className:"-striped -highlight percent50",data:this.state.usuarios,columns:R(this.props.t),sortable:!0,multiSort:!0,resizable:!0,filterable:!0,defaultPageSize:25,getTdProps:this.handlerGridAction,previousText:this.props.t("general.previous"),nextText:this.props.t("general.next"),loadingText:this.props.t("general.loading"),noDataText:this.props.t("general.norowsfound"),pageText:this.props.t("general.page"),ofText:this.props.t("general.of"),rowsText:this.props.t("general.rows")}),Object(H.jsx)(T.a,{className:"-striped -highlight percent50",data:this.state.sesiones,columns:(e=this.props.t,[{Header:e("usuarios.sessiones"),foldable:!0,columns:[{Header:"Token",accessor:"id"},{Header:e("session.expire"),accessor:"ttl"},{Header:e("session.created"),accessor:"created",Cell:function(e){return Object(H.jsx)(C.a,{format:"DD-MM-YYYY HH:mm",children:e.original.created})}},{Header:e("session.transcurrido"),Cell:function(e){return Object(H.jsx)(C.a,{locale:localStorage.getItem("i18nextLng"),fromNow:!0,ago:!0,children:e.original.created})}},{Header:"",filterable:!1,sortable:!1,width:40,Cell:function(s){return Object(H.jsx)("button",{className:w.a.eliminar,alt:e("general.eliminar"),children:Object(H.jsx)(S.Icon,{name:"close"})})}}]}]),sortable:!0,multiSort:!0,resizable:!0,filterable:!0,defaultPageSize:10,getTdProps:this.handlerGridActionSessiones,previousText:this.props.t("general.previous"),nextText:this.props.t("general.next"),loadingText:this.props.t("general.loading"),noDataText:this.props.t("general.norowsfound"),pageText:this.props.t("general.page"),ofText:this.props.t("general.of"),rowsText:this.props.t("general.rows")})]})]}):Object(H.jsx)(u.a,{direction:"columns",padding:"0",margin:"0",wrap:"wrap",children:Object(H.jsx)(p.a,{height:"100vh",children:Object(H.jsx)(v.c,{icon:"401",title:this.props.t("error.noAuth"),message:this.props.t("error.noAuthMessage")})})});var e}}]),t}(d.PureComponent);s.default=Object(O.a)()(N)},497:function(e,s,t){"use strict";t.d(s,"e",(function(){return o})),t.d(s,"a",(function(){return i})),t.d(s,"b",(function(){return n})),t.d(s,"c",(function(){return l})),t.d(s,"d",(function(){return c}));var a=t(7),r=t.n(a);function o(){return r()({method:"GET",url:"roles"})}function i(e){return r()({method:"POST",url:"roles",data:e})}function n(e){return r()({method:"PUT",url:"roles",data:e})}function l(e){return r()({method:"DELETE",url:"roles/"+e})}function c(e){return r()({method:"GET",url:"roles?filter[where][name]="+e})}},654:function(e,s,t){e.exports={form:"styles_form__2RweP",icon:"styles_icon__18lw3",shadow:"styles_shadow__1AdYn",title:"styles_title__1wlrg",eliminar:"styles_eliminar__3v5ld",btn:"styles_btn__34w-i"}}}]);
//# sourceMappingURL=20.aa0444d5.chunk.js.map